<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0a">
    <title>OpenCode</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: #0a0a0a; color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        
        .app { width: 100%; height: 100%; display: flex; flex-direction: column; }
        
        /* Welcome Screen */
        .welcome-screen { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 100%; 
            padding: 32px; 
            text-align: center; 
            background: linear-gradient(180deg, #0a0a0a 0%, #111 100%);
        }
        
        .logo-container {
            position: relative;
            margin-bottom: 32px;
        }
        
        .logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 60px rgba(99, 102, 241, 0.3);
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .logo svg { width: 60px; height: 60px; }
        
        .welcome-screen h1 {
            font-size: 32px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-screen p { color: #888; font-size: 16px; margin-bottom: 40px; max-width: 300px; line-height: 1.6; }
        
        .start-btn {
            background: linear-gradient(135deg, #6366f1, #a855f7);
            color: #fff;
            border: none;
            padding: 18px 56px;
            font-size: 17px;
            font-weight: 600;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
        }
        
        .start-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(99, 102, 241, 0.5); }
        .start-btn:active { transform: scale(0.98); }
        
        .features {
            display: flex;
            gap: 40px;
            margin-top: 56px;
        }
        
        .feature { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .feature-icon { font-size: 36px; }
        .feature p { margin: 0; font-size: 13px; color: #666; }
        
        .version { position: absolute; bottom: 20px; color: #444; font-size: 12px; }
        
        /* Chat Screen */
        .chat-screen { 
            display: none; 
            flex-direction: column; 
            height: 100%; 
            background: #0a0a0a;
        }
        
        .chat-screen.active { display: flex; }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            padding-bottom: 80px;
            -webkit-overflow-scrolling: touch;
        }
        
        .message {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            max-width: 100%;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user { flex-direction: row-reverse; }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .message.user .avatar { background: linear-gradient(135deg, #6366f1, #a855f7); }
        .message.assistant .avatar { background: #1a1a1a; border: 2px solid #333; }
        
        .message-content {
            flex: 1;
            min-width: 0;
            max-width: calc(100% - 60px);
        }
        
        .message-bubble {
            background: #1a1a1a;
            padding: 14px 18px;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #222;
        }
        
        .message.user .message-bubble {
            background: linear-gradient(135deg, #6366f1, #7c3aed);
            color: #fff;
            border: none;
        }
        
        .message-time {
            font-size: 11px;
            color: #666;
            margin-top: 6px;
            margin-left: 4px;
        }
        
        .message.user .message-time { text-align: right; margin-right: 4px; margin-left: 0; }
        
        /* Code blocks */
        .code-block {
            background: #0d0d0d;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre;
        }
        
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #333;
            border: none;
            color: #fff;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        
        /* Input Area */
        .input-area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #111;
            border-top: 1px solid #222;
            padding: 12px 16px 24px;
            padding-bottom: calc(24px + env(safe-area-inset-bottom));
        }
        
        .input-container {
            display: flex;
            gap: 10px;
            background: #1a1a1a;
            border-radius: 28px;
            padding: 6px;
            border: 1px solid #333;
            align-items: center;
        }
        
        .input-field {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 15px;
            padding: 12px 16px;
            outline: none;
            min-height: 48px;
            max-height: 120px;
            resize: none;
            font-family: inherit;
        }
        
        .input-field::placeholder { color: #666; }
        
        .send-btn {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            border: none;
            border-radius: 50%;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            flex-shrink: 0;
        }
        
        .send-btn:hover:not(:disabled) { transform: scale(1.05); }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Loading indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 18px 20px;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #6366f1;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
        
        /* Selection */
        ::selection { background: rgba(99, 102, 241, 0.3); color: #fff; }
    </style>
</head>
<body>
    <div class="app">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="welcome-screen">
            <div class="logo-container">
                <div class="logo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
            </div>
            <h1>OpenCode</h1>
            <p>Your autonomous AI coding agent for Android. Write code, execute commands, and build projects from your phone.</p>
            <button class="start-btn" onclick="startChat()">Start Coding</button>
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">ðŸ¤–</div>
                    <p>AI Agent</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">ðŸ’»</div>
                    <p>Code Editor</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">âš¡</div>
                    <p>Terminal</p>
                </div>
            </div>
            <div class="version">v1.0.0 â€¢ Powered by OpenCode AI</div>
        </div>

        <!-- Chat Screen -->
        <div id="chatScreen" class="chat-screen">
            <div id="messages" class="messages-container"></div>
        </div>

        <!-- Input Area -->
        <div id="inputArea" class="input-area" style="display: none;">
            <div class="input-container">
                <textarea 
                    id="messageInput" 
                    class="input-field" 
                    placeholder="Ask me to code something..."
                    rows="1"
                    oninput="autoResize(this)"
                    onkeydown="handleKeyDown(event)"></textarea>
                <button id="sendBtn" class="send-btn" onclick="sendMessage()" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        let isConnected = false;
        let messageHistory = [];
        let apiKey = 'sk-AmcUJKfcndoXVrUcTqvo3swHFFODOosMQcuQRDqCyeZ5HyU9Wt3PqQUVLYYEm7N3';
        
        function startChat() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('chatScreen').classList.add('active');
            document.getElementById('inputArea').style.display = 'block';
            
            // Welcome message
            addMessage('assistant', 'Welcome to OpenCode Mobile! ðŸš€\n\nI\'m your autonomous coding agent. I can help you:\n\nâ€¢ Write and edit code in any language\nâ€¢ Execute terminal commands\nâ€¢ Analyze and debug projects\nâ€¢ Create new applications\nâ€¢ Refactor existing code\n\nWhat would you like to build today?');
            
            // Try to connect to backend
            if (window.Android) {
                window.Android.showToast('Connecting to OpenCode server...');
            }
        }
        
        function addMessage(role, content, id = null) {
            const msgId = id || Date.now().toString();
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.id = `msg-${msgId}`;
            
            const avatar = role === 'user' ? 'ðŸ‘¤' : 'ðŸ¦ž';
            
            // Format content - detect code blocks
            let formattedContent = formatContent(content);
            
            messageDiv.innerHTML = `
                <div class="avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-bubble">${formattedContent}</div>
                    <div class="message-time">${timestamp}</div>
                </div>
            `;
            
            document.getElementById('messages').appendChild(messageDiv);
            scrollToBottom();
            
            messageHistory.push({ id: msgId, role, content, timestamp });
        }
        
        function formatContent(content) {
            // Handle code blocks
            content = content.replace(/```(\w+)?\n([\s\S]*?)```/g, '<div class="code-block"><code>$2</code></div>');
            // Handle inline code
            content = content.replace(/`([^`]+)`/g, '<code style="background: #333; padding: 2px 6px; border-radius: 4px; font-family: monospace;">$1</code>');
            // Handle line breaks
            content = content.replace(/\n/g, '<br>');
            return content;
        }
        
        function showTyping() {
            const id = 'typing-' + Date.now();
            const div = document.createElement('div');
            div.className = 'message assistant';
            div.id = id;
            div.innerHTML = `
                <div class="avatar">ðŸ¦ž</div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('messages').appendChild(div);
            scrollToBottom();
            return id;
        }
        
        function removeTyping(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            addMessage('user', text);
            input.value = '';
            input.style.height = 'auto';
            document.getElementById('sendBtn').disabled = true;
            
            const typingId = showTyping();
            
            // Simulate AI response (replace with actual API call)
            setTimeout(() => {
                removeTyping(typingId);
                
                // Process the message
                const response = generateResponse(text);
                addMessage('assistant', response);
                
            }, 1500);
        }
        
        function generateResponse(input) {
            const lower = input.toLowerCase();
            
            if (lower.includes('hello') || lower.includes('hi')) {
                return "Hello! ðŸ‘‹ I'm ready to help you code. What project are you working on?";
            }
            else if (lower.includes('code') || lower.includes('write')) {
                return "I'd be happy to write code for you! Here's an example:\n\n```javascript\n// Simple greeting function\nfunction greet(name) {\n  return `Hello, ${name}! ðŸ‘‹`;\n}\n\nconsole.log(greet('World'));\n```\n\nWhat specific functionality do you need?";
            }
            else if (lower.includes('error') || lower.includes('bug')) {
                return "I can help debug your code! Please share:\n\n1. The error message you're seeing\n2. The relevant code snippet\n3. What you expected to happen\n\nI'll analyze it and suggest fixes.";
            }
            else if (lower.includes('create') || lower.includes('app') || lower.includes('project')) {
                return "Great! Let's create something awesome. ðŸš€\n\nWhat type of project do you want to build?\n\nâ€¢ Mobile app\nâ€¢ Web application\nâ€¢ API/Backend\nâ€¢ Script/Automation\nâ€¢ Something else?\n\nTell me your idea and I'll help you build it!";
            }
            else {
                return `I received your message: "${input}"\n\nI'm processing this request and will help you accomplish it. In a full implementation, I would:\n\n1. Parse your intent using NLP\n2. Execute necessary commands via the backend\n3. Provide results and suggestions\n\n**Current Status:** Demo mode - backend integration required for full functionality.\n\nYour API key is configured: \`${apiKey.substring(0, 15)}...\``;
            }
        }
        
        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }
        
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = textarea.value.trim().length === 0;
        }
        
        function scrollToBottom() {
            const container = document.getElementById('messages');
            container.scrollTop = container.scrollHeight;
        }
        
        function clearChat() {
            document.getElementById('messages').innerHTML = '';
            messageHistory = [];
        }
        
        // Android interface callbacks
        function onAndroidReady() {
            console.log('Android interface ready');
        }
        
        // Expose functions to Android
        window.addMessage = addMessage;
        window.clearChat = clearChat;
        window.sendMessage = sendMessage;
    </script>
</body>
</html>
